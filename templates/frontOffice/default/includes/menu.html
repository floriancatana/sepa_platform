{hook name="category.sidebar-top"}
{ifhook rel="category.sidebar-body"}
   {hook name="category.sidebar-body"}
{/ifhook}
{elsehook rel="category.sidebar-body"}
<section id="categories" class="block block-nav" role="navigation" aria-labelledby="categories-label">
    <div class="block-heading">
        <h3 class="block-title" id="categories-label">{intl l="Kategorien"}</h3>
    </div>
    <div class="block-content">
        <nav class="nav-categories">

            {assign var="parent_cat" value={category attr="parent"}}

            {assign var="parent_cat_ids" value=[]}

            {* While it's not the top level category *}
            {while $parent_cat != 0}
                {assign var="current_loop_cat" value=$parent_cat}

                {loop name="set_parent_category" type="category" id=$parent_cat}
                    {assign var="parent_cat" value=$PARENT}
                    {append var="parent_cat_ids" value=$ID}
                {/loop}
            {/while}

            {* define the function *}
            {function menu level=0}
            {if $level == 0}
                <ul id="category" class="accordion">
            {else}
                {if in_array($parent, $parent_cat_ids)}
                    <ul id="collapse{$parent}" class="in">
                {else}
                    <ul id="collapse{$parent}" class="collapse">
                {/if}
            {/if}

            {loop name="cat-parent-$level" type="category" parent=$parent need_count_child=1 not_empty="1"}
                {if $CHILD_COUNT > 0}
                    {if in_array($ID, $parent_cat_ids)}
                        {assign var="collapsed" value=""}
                    {else}
                        {assign var="collapsed" value="collapsed"}
                    {/if}

                    <li>
                        <a href="{$URL nofilter}">
                            {$TITLE} ({count type="product" category=$ID})
                        </a>

                        <a href="#collapse{$ID}" class="accordion-toggle {$collapsed}" data-toggle="collapse" data-parent="#collapse{$ID}"></a>

                        {menu parent=$ID level=$level+1}
                    </li>
                {else}
                    <li>
                        <a href="{$URL nofilter}">
                            {$TITLE} ({count type="product" category=$ID})
                        </a>
                    </li>
                {/if}
            {/loop}

            </ul>
            {/function}

            {menu parent='0'}

        </nav>
    </div>
</section>

{assign var="search_criteria" value=$smarty.get.criteria}
{assign var="search_category" value=$smarty.get.category_id}
{assign var="search_brands" value=$smarty.get.brands}
{assign var="search_price_min" value=$smarty.get.price_min}
{assign var="search_price_max" value=$smarty.get.price_max}
{assign var="search_new" value=$smarty.get.new}
{assign var="search_promo" value=$smarty.get.promo} 
{assign var="search_limit" value=$smarty.get.limit}
{assign var="search_page" value=$smarty.get.page}
{assign var="search_order" value=$smarty.get.order}

{hook name="criteria-search.search-page" criteria=$search_criteria category=$search_category brands=$search_brands price_min=$search_price_min price_max=$search_price_max limit=$limit  new=$search_new promo=$search_promo limit=$search_limit page=$search_page order=$search_order}

{/elsehook}
{hook name="category.sidebar-bottom"}
